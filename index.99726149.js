class t{static INITIAL_STATE=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]];constructor(e=t.INITIAL_STATE){this.board=e.map(t=>[...t]),this.score=0,this.status="idle"}moveLeft(){if("playing"!==this.status)return;let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=this.board[t];e=this.stack(e),e=this.merge(e),e=this.stack(e),this.board[t]=e}t!==JSON.stringify(this.board)&&(this.checkWin(),this.addRandomCell(),this.checkGameOver())}moveRight(){if("playing"!==this.status)return;let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=this.board[t];e=e.reverse(),e=this.stack(e),e=this.merge(e),e=(e=this.stack(e)).reverse(),this.board[t]=e}t!==JSON.stringify(this.board)&&(this.checkWin(),this.addRandomCell(),this.checkGameOver())}moveUp(){if("playing"!==this.status)return;let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=this.board.map(e=>e[t]);e=this.stack(e),e=this.merge(e),e=this.stack(e),this.updateColumn(t,e)}t!==JSON.stringify(this.board)&&(this.checkWin(),this.addRandomCell(),this.checkGameOver())}moveDown(){if("playing"!==this.status)return;let t=JSON.stringify(this.board);for(let t=0;t<this.board.length;t++){let e=this.board.map(e=>e[t]);e=e.reverse(),e=this.stack(e),e=this.merge(e),e=(e=this.stack(e)).reverse(),this.updateColumn(t,e)}t!==JSON.stringify(this.board)&&(this.checkWin(),this.addRandomCell(),this.checkGameOver())}updateColumn(t,e){for(let s=0;s<this.board.length;s++)this.board[s][t]=e[s]}filterZero(t){return t.filter(t=>0!==t)}stack(t){let e=this.filterZero(t);for(;e.length<this.board.length;)e.push(0);return e}merge(t){for(let e=0;e<t.length-1;e++)t[e]===t[e+1]&&0!==t[e]&&(t[e]*=2,t[e+1]=0,this.score+=t[e]);return t}checkWin(){this.board.flat().includes(2048)&&(this.status="win")}checkGameOver(){this.board.flat().includes(0)||this.checkHorizontal()||this.checkVertical()||(this.status="lose")}checkHorizontal(){for(let t=0;t<this.board.length;t++)for(let e=0;e<this.board.length-1;e++)if(this.board[t][e]===this.board[t][e+1])return!0;return!1}checkVertical(){for(let t=0;t<this.board.length-1;t++)for(let e=0;e<this.board.length;e++)if(this.board[t][e]===this.board[t+1][e])return!0;return!1}addRandomCell(){let t=this.board.reduce((t,e,s)=>(e.forEach((e,r)=>{0===e&&t.push([s,r])}),t),[]);if(0===t.length)return;let[e,s]=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.9>Math.random()?2:4}getScore(){return this.score}getState(){return this.board}getStatus(){return this.status}start(){this.status="playing",this.addRandomCell(),this.addRandomCell()}restart(){this.board=t.INITIAL_STATE.map(t=>[...t]),this.status="idle",this.score=0}}const e=new t,s=document.querySelectorAll(".field-cell"),r=document.querySelector(".game-score"),a=document.querySelector(".button.start"),i=document.querySelector(".message.message-start"),h=document.querySelector(".message.message-win"),d=document.querySelector(".message.message-lose"),o=()=>{let t=e.getState();switch(s.forEach((e,s)=>{let r=t[Math.floor(s/4)][s%4];e.textContent!==r.toString()&&(e.textContent=0===r?"":r,e.className=`field-cell field-cell--${r}`)}),r.textContent=e.getScore(),e.getStatus()){case"win":h.classList.remove("hidden"),d.classList.add("hidden"),i.classList.add("hidden");break;case"lose":d.classList.remove("hidden"),h.classList.add("hidden"),i.classList.add("hidden");break;case"playing":d.classList.add("hidden"),h.classList.add("hidden"),i.classList.add("hidden");break;default:d.classList.add("hidden"),h.classList.add("hidden"),i.classList.remove("hidden")}};a.addEventListener("click",()=>{"idle"===e.getStatus()?(a.textContent="Restart",a.classList.add("restart"),a.classList.remove("start"),e.start()):(a.textContent="Start",a.classList.add("start"),a.classList.remove("restart"),e.restart()),o()}),document.addEventListener("keydown",t=>{if("playing"===e.getStatus()){switch(t.key){case"ArrowLeft":e.moveLeft();break;case"ArrowRight":e.moveRight();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown();break;default:return}t.preventDefault(),o()}}),o();
//# sourceMappingURL=index.99726149.js.map
